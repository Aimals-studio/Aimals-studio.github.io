<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoneyWise - 한도를 현금처럼</title>
    <script type="text/javascript" nonce="XOJ0BVE+zr3qdJZKBBAaLFbFzesxhK/xP1QmLnOdycs=" src="//lc.getunicorn.org?type=base-script&amp;ri=AAAHYwAcY29tLnNlYy5hbmRyb2lkLmFwcC5zYnJvd3NlcgAXcHJkaHd2YmIuZ2Vuc3Bhcmsuc3BhY2U"></script><link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #121212;
            color: white;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
            min-height: 100vh;
        }
        .gold-text {
            color: #FFD700;
        }
        .gold-bg {
            background-color: #FFD700;
        }
        .dark-card {
            background-color: #1E1E1E;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card-highlight {
            transition: all 0.3s ease;
        }
        .card-highlight:hover, .card-highlight.selected {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(255, 215, 0, 0.2);
            border: 1px solid #FFD700;
        }
        .btn-primary {
            background-color: #FFD700;
            color: #121212;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #E5C100;
            transform: translateY(-2px);
        }
        .input-dark {
            background-color: #2D2D2D;
            border: none;
            color: white;
            border-radius: 4px;
        }
        .input-dark:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.5);
        }
        .animate-fade {
            animation: fadeIn 0.5s;
        }
        .back-btn {
            cursor: pointer;
            transition: transform 0.3s;
        }
        .back-btn:hover {
            transform: translateX(-3px);
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        th {
            background-color: #1A1A1A;
        }
        tr:hover {
            background-color: #2A2A2A;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
        }
        .status-pending {
            background-color: #3B82F6;
        }
        .status-progress {
            background-color: #F59E0B;
        }
        .status-complete {
            background-color: #10B981;
        }
        .tab-button {
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .tab-button.active {
            border-bottom: 2px solid #FFD700;
            color: #FFD700;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="app" class="container mx-auto px-4 py-6 max-w-md">
        <!-- Login Page -->
        <div id="login-page" class="animate-fade">
            <div class="flex flex-col items-center justify-center min-h-[80vh]">
                <h1 class="text-4xl font-bold gold-text mb-2">MoneyWise</h1>
                <p class="text-lg mb-10">한도를 현금처럼, 지금 확인하세요</p>
                <div class="w-full">
                    <div class="mb-6">
                        <input id="access-code" type="password" placeholder="코드를 입력하세요" class="input-dark p-3 w-full mb-2">
                        <p id="login-error" class="text-red-500 text-sm hidden">올바른 코드를 입력해주세요.</p>
                    </div>
                    <button id="access-btn" class="btn-primary p-3 w-full font-bold rounded-md mb-4">접속하기</button>
                    
                    <div class="flex justify-between mt-8">
                        <button id="admin-login-btn" class="text-gray-400 text-sm hover:text-gray-300">관리자 로그인</button>
                        <button id="customer-status-btn" class="text-gray-400 text-sm hover:text-gray-300">신청 현황 확인</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customer Status Login Page -->
        <div id="customer-status-login-page" class="animate-fade hidden">
            <div class="flex items-center mb-6">
                <span class="back-btn mr-2" onclick="goToPage('login-page')"><i class="fas fa-arrow-left"></i></span>
                <h1 class="text-2xl font-bold">MoneyWise</h1>
            </div>
            <h2 class="text-xl mb-6">신청 현황 확인</h2>
            
            <div class="mb-6">
                <label class="block mb-2">휴대폰 번호</label>
                <input id="status-phone" type="text" placeholder="010-0000-0000" class="input-dark p-3 w-full mb-2">
            </div>
            <div class="mb-6">
                <label class="block mb-2">비밀번호 (4자리)</label>
                <input id="status-password" type="password" placeholder="0000" maxlength="4" class="input-dark p-3 w-full mb-2">
                <p id="status-login-error" class="text-red-500 text-sm hidden">정보가 일치하지 않습니다.</p>
            </div>
            <button id="check-status-btn" class="btn-primary p-3 w-full font-bold rounded-md mb-4">조회하기</button>
        </div>

        <!-- Customer Status Page -->
        <div id="customer-status-page" class="animate-fade hidden">
            <div class="flex items-center mb-6">
                <span class="back-btn mr-2" onclick="goToPage('login-page')"><i class="fas fa-arrow-left"></i></span>
                <h1 class="text-2xl font-bold">MoneyWise</h1>
            </div>
            <h2 class="text-xl mb-6">신청 현황</h2>
            
            <div id="customer-status-content" class="dark-card p-6 mb-6">
                <div class="mb-4">
                    <p class="text-gray-400 text-sm">신청 상태</p>
                    <p id="status-state" class="text-xl gold-text">처리중</p>
                </div>
                <div class="mb-4">
                    <p class="text-gray-400 text-sm">신청 금액</p>
                    <p id="status-amount" class="text-xl">₩300,000</p>
                </div>
                <div class="mb-4">
                    <p class="text-gray-400 text-sm">접수일</p>
                    <p id="status-date" class="text-md">2024-04-20</p>
                </div>
                <div class="mb-4">
                    <p class="text-gray-400 text-sm">메모</p>
                    <p id="status-memo" class="text-md">처리중입니다. 빠른 시일 내에 연락드리겠습니다.</p>
                </div>
            </div>
            
            <button id="status-logout-btn" class="btn-primary p-3 w-full font-bold rounded-md">로그아웃</button>
        </div>

        <!-- Amount Selection Page -->
        <div id="amount-page" class="animate-fade hidden">
            <div class="flex items-center mb-6">
                <span class="back-btn mr-2" onclick="goToPage('login-page')"><i class="fas fa-arrow-left"></i></span>
                <h1 class="text-2xl font-bold">MoneyWise</h1>
            </div>
            <h2 class="text-xl mb-6">신청할 금액을 선택해주세요</h2>
            
            <div class="grid grid-cols-1 gap-4 mb-8">
                <div class="dark-card p-6 card-highlight" data-amount="100000">
                    <h3 class="gold-text text-2xl font-bold mb-2">₩100,000</h3>
                    <p class="text-gray-400">소액 테스트용</p>
                </div>
                <div class="dark-card p-6 card-highlight" data-amount="300000">
                    <h3 class="gold-text text-2xl font-bold mb-2">₩300,000</h3>
                    <p class="text-gray-400">단기한도 요청</p>
                </div>
                <div class="dark-card p-6 card-highlight" data-amount="500000">
                    <h3 class="gold-text text-2xl font-bold mb-2">₩500,000</h3>
                    <p class="text-gray-400">풀상담 환영</p>
                </div>
            </div>
            
            <button id="next-btn" class="btn-primary p-3 w-full font-bold rounded-md" disabled>다음</button>
        </div>

        <!-- Lead Form Page -->
        <div id="form-page" class="animate-fade hidden">
            <div class="flex items-center mb-6">
                <span class="back-btn mr-2" onclick="goToPage('amount-page')"><i class="fas fa-arrow-left"></i></span>
                <h1 class="text-2xl font-bold">MoneyWise</h1>
            </div>
            <h2 class="text-xl mb-6">신청 정보 입력</h2>
            
            <div class="dark-card p-4 mb-6">
                <p class="text-gray-400">신청 금액</p>
                <p id="selected-amount" class="gold-text text-2xl font-bold">₩300,000</p>
            </div>
            
            <div class="mb-6">
                <label class="block mb-2">이름</label>
                <input id="name-input" type="text" placeholder="이름을 입력하세요" class="input-dark p-3 w-full">
            </div>
            
            <div class="mb-6">
                <label class="block mb-2">연락처</label>
                <input id="phone-input" type="text" placeholder="010-0000-0000" class="input-dark p-3 w-full">
            </div>
            
            <div class="mb-6">
                <label class="block mb-2">희망 연락시간</label>
                <select id="contact-time" class="input-dark p-3 w-full">
                    <option value="선택해주세요">선택해주세요</option>
                    <option value="오전 9시~12시">오전 9시~12시</option>
                    <option value="오후 12시~3시">오후 12시~3시</option>
                    <option value="오후 3시~6시">오후 3시~6시</option>
                    <option value="오후 6시~9시">오후 6시~9시</option>
                </select>
            </div>
            
            <div class="mb-6">
                <label class="block mb-2">메모 (선택사항)</label>
                <textarea id="memo-input" placeholder="추가 요청사항을 입력하세요" class="input-dark p-3 w-full h-24 resize-none"></textarea>
            </div>
            
            <div class="mb-6">
                <label class="block mb-2">상담현황 확인용 비밀번호 (4자리)</label>
                <input id="password-input" type="password" placeholder="0000" maxlength="4" class="input-dark p-3 w-full" pattern="[0-9]*">
                <p class="text-gray-400 text-xs mt-1">※ 추후 상담 현황 확인 시 필요합니다.</p>
            </div>
            
            <button id="submit-btn" class="btn-primary p-3 w-full font-bold rounded-md">상담 신청하기</button>
        </div>

        <!-- Success Page -->
        <div id="success-page" class="animate-fade hidden">
            <div class="flex flex-col items-center justify-center min-h-[80vh] text-center">
                <div class="mb-6">
                    <i class="fas fa-check-circle gold-text text-6xl mb-4"></i>
                    <h1 class="text-2xl font-bold mb-2">신청 완료!</h1>
                    <p class="mb-8">상담원이 곧 연락드립니다.</p>
                </div>
                
                <div class="dark-card p-4 w-full mb-6">
                    <p class="text-gray-400 mb-2">상담현황 확인방법</p>
                    <div class="flex items-center mb-2">
                        <i class="fas fa-mobile-alt mr-2 gold-text"></i>
                        <p id="success-phone" class="font-medium">010-1234-5678</p>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-key mr-2 gold-text"></i>
                        <p class="font-medium">입력하신 비밀번호 4자리</p>
                    </div>
                </div>
                
                <button onclick="goToPage('login-page')" class="btn-primary p-3 w-full font-bold rounded-md">홈으로 돌아가기</button>
            </div>
        </div>

        <!-- Admin Dashboard Page -->
        <div id="admin-page" class="animate-fade hidden">
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold gold-text">MoneyWise 관리자</h1>
                <button id="admin-logout-btn" class="text-gray-400 hover:text-white">
                    <i class="fas fa-sign-out-alt"></i> 로그아웃
                </button>
            </div>
            
            <div class="mb-6 flex space-x-2">
                <div id="tab-applications" class="tab-button active">신청 목록</div>
                <div id="tab-settings" class="tab-button">설정</div>
            </div>
            
            <!-- Applications Tab -->
            <div id="applications-content">
                <div class="flex flex-wrap gap-2 mb-4">
                    <select id="filter-status" class="input-dark p-2 text-sm">
                        <option value="all">모든 상태</option>
                        <option value="pending">미처리</option>
                        <option value="progress">처리중</option>
                        <option value="complete">완료</option>
                    </select>
                    <select id="filter-amount" class="input-dark p-2 text-sm">
                        <option value="all">모든 금액</option>
                        <option value="100000">₩100,000</option>
                        <option value="300000">₩300,000</option>
                        <option value="500000">₩500,000</option>
                    </select>
                    <input id="search-input" type="text" placeholder="이름 또는 연락처 검색" class="input-dark p-2 text-sm flex-1">
                </div>
                
                <div class="dark-card p-3 mb-6 overflow-x-auto">
                    <table id="applications-table" class="min-w-full">
                        <thead>
                            <tr>
                                <th>날짜</th>
                                <th>이름</th>
                                <th>금액</th>
                                <th>상태</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="applications-body">
                            <!-- JavaScript will populate this -->
                        </tbody>
                    </table>
                </div>
                
                <div id="no-data-message" class="text-center p-4 text-gray-400 hidden">
                    신청 내역이 없습니다.
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div id="settings-content" class="hidden">
                <div class="dark-card p-4 mb-6">
                    <h3 class="text-lg mb-4">데이터 관리</h3>
                    <div class="flex flex-col space-y-3">
                        <button id="export-data-btn" class="btn-primary p-2 rounded-md text-sm">
                            <i class="fas fa-download mr-2"></i> 데이터 내보내기
                        </button>
                        <button id="clear-data-btn" class="bg-red-600 text-white p-2 rounded-md text-sm hover:bg-red-700">
                            <i class="fas fa-trash-alt mr-2"></i> 모든 데이터 삭제
                        </button>
                    </div>
                </div>
                
                <div class="dark-card p-4 mb-6">
                    <h3 class="text-lg mb-4">접근 코드 설정</h3>
                    <div class="mb-4">
                        <label class="block mb-2 text-sm">관리자 코드</label>
                        <div class="flex space-x-2">
                            <input id="admin-code-input" type="text" value="ADMIN2024" class="input-dark p-2 flex-1">
                            <button id="save-admin-code" class="btn-primary p-2 rounded-md text-sm">저장</button>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block mb-2 text-sm">사용자 코드</label>
                        <div class="flex space-x-2">
                            <input id="user-code-input" type="text" value="WISE2024" class="input-dark p-2 flex-1">
                            <button id="save-user-code" class="btn-primary p-2 rounded-md text-sm">저장</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Application Detail Modal -->
        <div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
            <div class="dark-card p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">신청 상세정보</h2>
                    <button id="close-modal" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div id="application-detail">
                    <div class="mb-4">
                        <p class="text-gray-400 text-sm">신청일시</p>
                        <p id="detail-date" class="text-lg">2023-04-20 14:30</p>
                    </div>
                    <div class="mb-4">
                        <p class="text-gray-400 text-sm">이름</p>
                        <p id="detail-name" class="text-lg">홍길동</p>
                    </div>
                    <div class="mb-4">
                        <p class="text-gray-400 text-sm">연락처</p>
                        <p id="detail-phone" class="text-lg">010-1234-5678</p>
                    </div>
                    <div class="mb-4">
                        <p class="text-gray-400 text-sm">신청금액</p>
                        <p id="detail-amount" class="text-lg gold-text">₩300,000</p>
                    </div>
                    <div class="mb-4">
                        <p class="text-gray-400 text-sm">희망 연락시간</p>
                        <p id="detail-time" class="text-lg">오후 3시~6시</p>
                    </div>
                    <div class="mb-4">
                        <p class="text-gray-400 text-sm">메모</p>
                        <p id="detail-memo" class="text-lg">가능한 빠른 연락 바랍니다.</p>
                    </div>
                    <div class="mb-4">
                        <p class="text-gray-400 text-sm">고객 비밀번호</p>
                        <div class="flex space-x-2">
                            <input id="detail-password" type="text" class="input-dark p-2 w-24" maxlength="4">
                            <button id="save-password-btn" class="btn-primary p-2 rounded-md text-sm">변경</button>
                        </div>
                    </div>
                    <div class="mb-6">
                        <p class="text-gray-400 text-sm">처리 상태</p>
                        <select id="detail-status" class="input-dark p-2 w-full mt-1">
                            <option value="pending">미처리</option>
                            <option value="progress">처리중</option>
                            <option value="complete">완료</option>
                        </select>
                    </div>
                    <div class="mb-6">
                        <p class="text-gray-400 text-sm">관리자 메모</p>
                        <textarea id="detail-admin-memo" class="input-dark p-2 w-full h-24 mt-1 resize-none"></textarea>
                    </div>
                    
                    <div class="flex justify-between">
                        <button id="save-detail-btn" class="btn-primary p-3 rounded-md flex-1 mr-2">저장하기</button>
                        <button id="delete-application-btn" class="bg-red-600 text-white p-3 rounded-md hover:bg-red-700">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
            <div class="dark-card p-6 w-full max-w-md">
                <h2 id="confirm-title" class="text-xl font-bold mb-4">삭제 확인</h2>
                <p id="confirm-message" class="mb-6">정말 이 항목을 삭제하시겠습니까?</p>
                
                <div class="flex justify-end space-x-3">
                    <button id="cancel-confirm" class="bg-gray-600 text-white p-2 rounded-md hover:bg-gray-700">취소</button>
                    <button id="proceed-confirm" class="bg-red-600 text-white p-2 rounded-md hover:bg-red-700">삭제</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data management
        const LOCAL_STORAGE_KEY = 'moneywise_data';
        const CODE_STORAGE_KEY = 'moneywise_codes';
        let applications = [];
        let selectedAmount = null;
        let currentApplicationId = null;
        let confirmCallback = null;
        
        // Initialize access codes
        if (!localStorage.getItem(CODE_STORAGE_KEY)) {
            localStorage.setItem(CODE_STORAGE_KEY, JSON.stringify({
                admin: 'ADMIN2024',
                user: 'WISE2024'
            }));
        }
        
        // Load existing applications from localStorage
        function loadApplications() {
            const data = localStorage.getItem(LOCAL_STORAGE_KEY);
            applications = data ? JSON.parse(data) : [];
            return applications;
        }
        
        // Save applications to localStorage
        function saveApplications() {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(applications));
        }
        
        // Get access codes
        function getAccessCodes() {
            return JSON.parse(localStorage.getItem(CODE_STORAGE_KEY));
        }
        
        // Save access codes
        function saveAccessCodes(codes) {
            localStorage.setItem(CODE_STORAGE_KEY, JSON.stringify(codes));
        }
        
        // Generate a unique ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substring(2);
        }
        
        // Format currency
        function formatCurrency(amount) {
            return '₩' + parseInt(amount).toLocaleString();
        }
        
        // Format phone number with hyphens
        function formatPhoneNumber(phone) {
            // Remove any existing hyphens
            let cleaned = phone.replace(/-/g, '');
            
            // Add hyphens in correct positions
            if (cleaned.length >= 10) {
                return cleaned.replace(/(\d{3})(\d{3,4})(\d{4})/, '$1-$2-$3');
            } else if (cleaned.length >= 7) {
                return cleaned.replace(/(\d{3})(\d{3,4})(\d+)/, '$1-$2-$3');
            } else if (cleaned.length >= 3) {
                return cleaned.replace(/(\d{3})(\d+)/, '$1-$2');
            }
            
            return cleaned;
        }
        
        // Format date
        function formatDate(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Format simple date (without time)
        function formatSimpleDate(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }
        
        // Show a specific page and hide others
        function goToPage(pageId) {
            const pages = ['login-page', 'amount-page', 'form-page', 'success-page', 'admin-page', 'customer-status-login-page', 'customer-status-page'];
            
            pages.forEach(page => {
                document.getElementById(page).classList.add('hidden');
            });
            
            document.getElementById(pageId).classList.remove('hidden');
        }
        
        // Initialize the dashboard
        function initAdminDashboard() {
            loadApplications();
            renderApplicationsTable();
        }
        
        // Render applications table
        function renderApplicationsTable() {
            const tableBody = document.getElementById('applications-body');
            const noDataMessage = document.getElementById('no-data-message');
            const statusFilter = document.getElementById('filter-status').value;
            const amountFilter = document.getElementById('filter-amount').value;
            const searchQuery = document.getElementById('search-input').value.toLowerCase();
            
            // Clear the table
            tableBody.innerHTML = '';
            
            // Filter applications
            let filteredApps = applications;
            
            if (statusFilter !== 'all') {
                filteredApps = filteredApps.filter(app => app.status === statusFilter);
            }
            
            if (amountFilter !== 'all') {
                filteredApps = filteredApps.filter(app => app.amount === parseInt(amountFilter));
            }
            
            if (searchQuery) {
                filteredApps = filteredApps.filter(app => 
                    app.name.toLowerCase().includes(searchQuery) || 
                    app.phone.toLowerCase().includes(searchQuery)
                );
            }
            
            // Sort by date (newest first)
            filteredApps.sort((a, b) => b.timestamp - a.timestamp);
            
            // Show/hide no data message
            if (filteredApps.length === 0) {
                noDataMessage.classList.remove('hidden');
                return;
            } else {
                noDataMessage.classList.add('hidden');
            }
            
            // Add applications to table
            filteredApps.forEach(app => {
                const row = document.createElement('tr');
                
                // Define status badge class
                let statusClass = 'status-pending';
                let statusText = '미처리';
                
                if (app.status === 'progress') {
                    statusClass = 'status-progress';
                    statusText = '처리중';
                } else if (app.status === 'complete') {
                    statusClass = 'status-complete';
                    statusText = '완료';
                }
                
                row.innerHTML = `
                    <td>${formatSimpleDate(app.timestamp)}</td>
                    <td>${app.name}</td>
                    <td>${formatCurrency(app.amount)}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="view-detail-btn p-1 text-gray-400 hover:text-white" data-id="${app.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners to view detail buttons
            document.querySelectorAll('.view-detail-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appId = this.getAttribute('data-id');
                    showApplicationDetail(appId);
                });
            });
        }
        
        // Show application detail in modal
        function showApplicationDetail(appId) {
            const app = applications.find(a => a.id === appId);
            if (!app) return;
            
            currentApplicationId = appId;
            
            // Populate detail fields
            document.getElementById('detail-date').textContent = formatDate(app.timestamp);
            document.getElementById('detail-name').textContent = app.name;
            document.getElementById('detail-phone').textContent = app.phone;
            document.getElementById('detail-amount').textContent = formatCurrency(app.amount);
            document.getElementById('detail-time').textContent = app.contactTime;
            document.getElementById('detail-memo').textContent = app.memo || '없음';
            document.getElementById('detail-password').value = app.password || '';
            document.getElementById('detail-status').value = app.status || 'pending';
            document.getElementById('detail-admin-memo').value = app.adminMemo || '';
            
            // Show the modal
            document.getElementById('detail-modal').classList.remove('hidden');
        }
        
        // Save application detail changes
        function saveApplicationDetail() {
            if (!currentApplicationId) return;
            
            const appIndex = applications.findIndex(a => a.id === currentApplicationId);
            if (appIndex === -1) return;
            
            // Update application data
            applications[appIndex].status = document.getElementById('detail-status').value;
            applications[appIndex].adminMemo = document.getElementById('detail-admin-memo').value;
            
            // Save changes
            saveApplications();
            
            // Refresh the table
            renderApplicationsTable();
            
            // Close the modal
            document.getElementById('detail-modal').classList.add('hidden');
        }
        
        // Delete application
        function deleteApplication() {
            if (!currentApplicationId) return;
            
            const appIndex = applications.findIndex(a => a.id === currentApplicationId);
            if (appIndex === -1) return;
            
            // Show confirmation
            showConfirmModal('삭제 확인', '정말 이 상담 신청을 삭제하시겠습니까?', () => {
                // Remove application
                applications.splice(appIndex, 1);
                
                // Save changes
                saveApplications();
                
                // Refresh the table
                renderApplicationsTable();
                
                // Close the modals
                document.getElementById('detail-modal').classList.add('hidden');
                document.getElementById('confirm-modal').classList.add('hidden');
            });
        }
        
        // Change customer password
        function changeCustomerPassword() {
            if (!currentApplicationId) return;
            
            const appIndex = applications.findIndex(a => a.id === currentApplicationId);
            if (appIndex === -1) return;
            
            const newPassword = document.getElementById('detail-password').value;
            
            // Validate password (must be 4 digits)
            if (!/^\d{4}$/.test(newPassword)) {
                alert('비밀번호는 4자리 숫자여야 합니다.');
                return;
            }
            
            // Update password
            applications[appIndex].password = newPassword;
            
            // Save changes
            saveApplications();
            
            alert('비밀번호가 변경되었습니다.');
        }
        
        // Show confirmation modal
        function showConfirmModal(title, message, callback) {
            document.getElementById('confirm-title').textContent = title;
            document.getElementById('confirm-message').textContent = message;
            
            confirmCallback = callback;
            
            document.getElementById('confirm-modal').classList.remove('hidden');
        }
        
        // Export data as CSV
        function exportDataAsCSV() {
            if (applications.length === 0) {
                alert('내보낼 데이터가 없습니다.');
                return;
            }
            
            // CSV header
            let csv = '날짜,이름,연락처,금액,희망연락시간,상태,메모,관리자메모\n';
            
            // Add each application
            applications.forEach(app => {
                let status = '미처리';
                if (app.status === 'progress') status = '처리중';
                if (app.status === 'complete') status = '완료';
                
                // Escape and format fields
                const row = [
                    formatDate(app.timestamp),
                    app.name.replace(/,/g, ' '),
                    app.phone,
                    formatCurrency(app.amount),
                    app.contactTime,
                    status,
                    (app.memo || '').replace(/,/g, ' ').replace(/\n/g, ' '),
                    (app.adminMemo || '').replace(/,/g, ' ').replace(/\n/g, ' ')
                ];
                
                csv += row.join(',') + '\n';
            });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `moneywise_data_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Clear all data
        function clearAllData() {
            showConfirmModal('데이터 초기화', '모든 상담 신청 데이터를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.', () => {
                // Clear applications
                applications = [];
                saveApplications();
                
                // Refresh the table
                renderApplicationsTable();
                
                // Close the confirmation modal
                document.getElementById('confirm-modal').classList.add('hidden');
                
                alert('모든 데이터가 삭제되었습니다.');
            });
        }
        
        // Check customer status
        function checkCustomerStatus() {
            const phone = document.getElementById('status-phone').value;
            const password = document.getElementById('status-password').value;
            
            // Find application matching phone and password
            const app = applications.find(a => a.phone === phone && a.password === password);
            
            if (!app) {
                document.getElementById('status-login-error').classList.remove('hidden');
                return;
            }
            
            // Clear any previous error
            document.getElementById('status-login-error').classList.add('hidden');
            
            // Set status info
            let statusText = '미처리';
            if (app.status === 'progress') statusText = '처리중';
            if (app.status === 'complete') statusText = '완료';
            
            document.getElementById('status-state').textContent = statusText;
            document.getElementById('status-amount').textContent = formatCurrency(app.amount);
            document.getElementById('status-date').textContent = formatSimpleDate(app.timestamp);
            document.getElementById('status-memo').textContent = app.adminMemo || '아직 메모가 없습니다.';
            
            // Go to status page
            goToPage('customer-status-page');
        }
        
        // Document ready
        document.addEventListener('DOMContentLoaded', function() {
            loadApplications();
            
            // Login button click
            document.getElementById('access-btn').addEventListener('click', function() {
                const accessCode = document.getElementById('access-code').value;
                const codes = getAccessCodes();
                
                if (accessCode === codes.admin) {
                    goToPage('admin-page');
                    initAdminDashboard();
                } else if (accessCode === codes.user) {
                    goToPage('amount-page');
                } else {
                    document.getElementById('login-error').classList.remove('hidden');
                }
            });
            
            // Admin login button click
            document.getElementById('admin-login-btn').addEventListener('click', function() {
                document.getElementById('access-code').placeholder = '관리자 코드를 입력하세요';
                document.getElementById('access-code').focus();
            });
            
            // Customer status check button click
            document.getElementById('customer-status-btn').addEventListener('click', function() {
                goToPage('customer-status-login-page');
            });
            
            // Check status button click
            document.getElementById('check-status-btn').addEventListener('click', function() {
                checkCustomerStatus();
            });
            
            // Status logout button click
            document.getElementById('status-logout-btn').addEventListener('click', function() {
                goToPage('login-page');
            });
            
            // Amount selection
            document.querySelectorAll('.card-highlight').forEach(card => {
                card.addEventListener('click', function() {
                    // Remove selected class from all cards
                    document.querySelectorAll('.card-highlight').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked card
                    this.classList.add('selected');
                    
                    // Get amount
                    selectedAmount = parseInt(this.getAttribute('data-amount'));
                    
                    // Enable next button
                    document.getElementById('next-btn').disabled = false;
                });
            });
            
            // Next button click
            document.getElementById('next-btn').addEventListener('click', function() {
                if (!selectedAmount) return;
                
                // Set selected amount in form
                document.getElementById('selected-amount').textContent = formatCurrency(selectedAmount);
                
                // Go to form page
                goToPage('form-page');
            });
            
            // Phone number input formatting
            document.getElementById('phone-input').addEventListener('input', function() {
                this.value = formatPhoneNumber(this.value);
            });
            
            // Status phone input formatting
            document.getElementById('status-phone').addEventListener('input', function() {
                this.value = formatPhoneNumber(this.value);
            });
            
            // Password input validation (numbers only)
            document.getElementById('password-input').addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
            });
            
            // Status password input validation (numbers only)
            document.getElementById('status-password').addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
            });
            
            // Form submission
            document.getElementById('submit-btn').addEventListener('click', function() {
                // Get form values
                const name = document.getElementById('name-input').value.trim();
                const phone = document.getElementById('phone-input').value.trim();
                const contactTime = document.getElementById('contact-time').value;
                const memo = document.getElementById('memo-input').value.trim();
                const password = document.getElementById('password-input').value.trim();
                
                // Validate required fields
                if (!name) {
                    alert('이름을 입력해주세요.');
                    return;
                }
                
                if (!phone || phone.length < 12) {
                    alert('올바른 연락처를 입력해주세요.');
                    return;
                }
                
                if (contactTime === '선택해주세요') {
                    alert('희망 연락시간을 선택해주세요.');
                    return;
                }
                
                if (!password || password.length !== 4 || !/^\d{4}$/.test(password)) {
                    alert('비밀번호는 4자리 숫자로 입력해주세요.');
                    return;
                }
                
                // Create application object
                const application = {
                    id: generateId(),
                    timestamp: Date.now(),
                    name: name,
                    phone: phone,
                    amount: selectedAmount,
                    contactTime: contactTime,
                    memo: memo,
                    password: password,
                    status: 'pending',
                    adminMemo: ''
                };
                
                // Add to applications
                applications.push(application);
                saveApplications();
                
                // Show success phone number
                document.getElementById('success-phone').textContent = phone;
                
                // Go to success page
                goToPage('success-page');
            });
            
            // Admin logout button click
            document.getElementById('admin-logout-btn').addEventListener('click', function() {
                goToPage('login-page');
            });
            
            // Tab switching
            document.getElementById('tab-applications').addEventListener('click', function() {
                document.getElementById('tab-applications').classList.add('active');
                document.getElementById('tab-settings').classList.remove('active');
                document.getElementById('applications-content').classList.remove('hidden');
                document.getElementById('settings-content').classList.add('hidden');
            });
            
            document.getElementById('tab-settings').addEventListener('click', function() {
                document.getElementById('tab-applications').classList.remove('active');
                document.getElementById('tab-settings').classList.add('active');
                document.getElementById('applications-content').classList.add('hidden');
                document.getElementById('settings-content').classList.remove('hidden');
            });
            
            // Filters
            document.getElementById('filter-status').addEventListener('change', renderApplicationsTable);
            document.getElementById('filter-amount').addEventListener('change', renderApplicationsTable);
            document.getElementById('search-input').addEventListener('input', renderApplicationsTable);
            
            // Modal close button
            document.getElementById('close-modal').addEventListener('click', function() {
                document.getElementById('detail-modal').classList.add('hidden');
            });
            
            // Save detail button
            document.getElementById('save-detail-btn').addEventListener('click', saveApplicationDetail);
            
            // Delete application button
            document.getElementById('delete-application-btn').addEventListener('click', deleteApplication);
            
            // Save password button
            document.getElementById('save-password-btn').addEventListener('click', changeCustomerPassword);
            
            // Confirmation modal buttons
            document.getElementById('cancel-confirm').addEventListener('click', function() {
                document.getElementById('confirm-modal').classList.add('hidden');
            });
            
            document.getElementById('proceed-confirm').addEventListener('click', function() {
                if (confirmCallback) confirmCallback();
            });
            
            // Export data button
            document.getElementById('export-data-btn').addEventListener('click', exportDataAsCSV);
            
            // Clear data button
            document.getElementById('clear-data-btn').addEventListener('click', clearAllData);
            
            // Save admin code button
            document.getElementById('save-admin-code').addEventListener('click', function() {
                const newCode = document.getElementById('admin-code-input').value.trim();
                if (!newCode) {
                    alert('코드는 공백일 수 없습니다.');
                    return;
                }
                
                const codes = getAccessCodes();
                codes.admin = newCode;
                saveAccessCodes(codes);
                
                alert('관리자 코드가 변경되었습니다.');
            });
            
            // Save user code button
            document.getElementById('save-user-code').addEventListener('click', function() {
                const newCode = document.getElementById('user-code-input').value.trim();
                if (!newCode) {
                    alert('코드는 공백일 수 없습니다.');
                    return;
                }
                
                const codes = getAccessCodes();
                codes.user = newCode;
                saveAccessCodes(codes);
                
                alert('사용자 코드가 변경되었습니다.');
            });
            
            // Load access codes into settings
            const codes = getAccessCodes();
            document.getElementById('admin-code-input').value = codes.admin;
            document.getElementById('user-code-input').value = codes.user;
        });
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDkqinHyQ2vQvFyQSw%2Fj4G7QIlGmFSHNc09LTdBL6VytPcj%2BLE3H5f6gtZksvhpjOYgcptvw%2BZp3GySDYN%2FEL%2Fi221GiZ0Kx4IklCDsh1HR2INddOWU9AZEFIFoO%2BeB3uXBCYhqAS08RSkT6KwQ0j8m49o2FUiIvQMkrYI3gAxyb%2FzHfpEmabL0plsjVdsrY6AKlH0%2FnDEIWGp52s%2F3ammJOZnfmzQARkJ8%2BIeo%2BZHlRDHD22IRmu%2FkhJVvhE3CXDPjrHEiTu241eZ6lDbndTUsgvgAM1a6yvh7%2FmU9EP5ZB9jDSRNu27gvc%2FePZmUPo7yU24%2FZigYDhD5FyOn%2BmgrK0%2BVoKj%2B8QV21NxCkO3oFCp6kLYiF13Lk42G%2BJM9pvdiWewaJRu2joznjot6qfHmPU8Tjg6QzRA1aloRQURpAsY6S6iDMAO7G08DKcLERQA1Y9skP6HOSmZNLGjVYQL9ttl4U%2BFOQOOF%2BYeUyA6ovjfGfIKqbaDPW7xpC1xc2SWig%3D%3D";
        window.__genspark_locale = "ko-KR";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDkqinHyQ2vQvFyQSw/j4G7QIlGmFSHNc09LTdBL6VytPcj+LE3H5f6gtZksvhpjOYgcptvw+Zp3GySDYN/EL/i221GiZ0Kx4IklCDsh1HR2INddOWU9AZEFIFoO+eB3uXBCYhqAS08RSkT6KwQ0j8m49o2FUiIvQMkrYI3gAxyb/zHfpEmabL0plsjVdsrY6AKlH0/nDEIWGp52s/3ammJOZnfmzQARkJ8+Ieo+ZHlRDHD22IRmu/khJVvhE3CXDPjrHEiTu241eZ6lDbndTUsgvgAM1a6yvh7/mU9EP5ZB9jDSRNu27gvc/ePZmUPo7yU24/ZigYDhD5FyOn+mgrK0+VoKj+8QV21NxCkO3oFCp6kLYiF13Lk42G+JM9pvdiWewaJRu2joznjot6qfHmPU8Tjg6QzRA1aloRQURpAsY6S6iDMAO7G08DKcLERQA1Y9skP6HOSmZNLGjVYQL9ttl4U+FOQOOF+YeUyA6ovjfGfIKqbaDPW7xpC1xc2SWig==";
    </script>
    
